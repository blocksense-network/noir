use clap::Args;
use format_trace::{
    prettify::{self, correct_path},
    read_write_json::{save_to_file, serialize_file},
};
use serde_json::Value;

use crate::errors::CliError;

/// Format a trace generated by `nargo trace` and save it
#[derive(Debug, Clone, Args)]
pub(crate) struct FmtTraceCommand {
    /// Trace file which we want to format
    src_file: String,

    /// Path where the formatted trace will be saved
    target_file: String,
}

pub(crate) fn run(args: FmtTraceCommand) -> Result<(), CliError> {
    let ser_json: Value = serialize_file(args.src_file);

    let prettified_json: String = prettify::prettify_value(ser_json, "", false);
    let final_pretty_json: String = correct_path(&prettified_json);

    save_to_file(args.target_file, final_pretty_json);
    Ok(())
}
